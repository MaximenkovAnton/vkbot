# –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

VK Bot –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ **Clean Architecture** (–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞) —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º **Event-driven** –ø–æ–¥—Ö–æ–¥–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–µ–≥–æ –≤—ã—Å–æ–∫—É—é —Å—Ç–µ–ø–µ–Ω—å —Ä–∞–∑–≤—è–∑–∫–∏, —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –≥–∏–±–∫–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### Clean Architecture
–ü—Ä–æ–µ–∫—Ç —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –†–æ–±–µ—Ä—Ç–∞ –ú–∞—Ä—Ç–∏–Ω–∞:

1. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Quarkus
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç UI** - VK API –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Telegram –∏–ª–∏ –¥—Ä—É–≥–æ–π
4. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - PostgreSQL –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ MongoDB
5. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤** - AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### Event-Driven Architecture

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** - –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
- **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - —Å–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** - –ø–æ–ª–Ω—ã–π audit trail –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Domain Layer (–î–æ–º–µ–Ω)
- **Entities**: `Message` - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—å
- **Value Objects**: `MessageText`, `PeerId`, `FromId` –∏ –¥—Ä. - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã
- **Events**: `MESSAGE_RECEIVED`, `MESSAGE_REQUIRE_ANSWER`, `SEND_MESSAGE`

### Application Layer (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- **Use Cases**: –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ, –æ–ø–∏—Å—ã–≤–∞—é—Ç **—á—Ç–æ** –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏
- **Ports**: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Commands**: –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –æ–ø–∏—Å—ã–≤–∞—é—Ç **–∫–∞–∫** –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ UseCase –∏ Command**:
Use case —è–≤–ª—è–µ—Ç—Å—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–µ–π –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ä—Ç–∞ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è, –¥–µ–ª–µ–≥–∏—Ä—É—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥–∞–º. Commands –≤—ã–ø–æ–ª–Ω—è—é—Ç –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –ø–æ—Ä—Ç—ã, –ø—Ä–∏ —ç—Ç–æ–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ use case'–∞–º–∏.

### Interface Adapters (–ê–¥–∞–ø—Ç–µ—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)
- **Input Adapters**: REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è VK webhook'–æ–≤
- **Output Adapters**: –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è VK API, AI —Å–µ—Ä–≤–∏—Å–æ–≤
- **Event Processors**: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

### Infrastructure (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **Message Broker**: RabbitMQ –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- **Web Framework**: Quarkus
- **Configuration**: YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üîÑ –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```mermaid
sequenceDiagram
    participant VK_IN as VK INPUT
    participant Receiver as Receiver Module
    participant MQ as RabbitMQ
    participant Processor as Processor Module
    participant AI as AI Service
    participant Facade as VK Facade
    participant VK_OUT as VK OUTPUT

    VK_IN->>Receiver: POST /vk/callback
    Receiver->>Receiver: Security check
    Receiver->>Receiver: Map VK_IN ‚Üí Domain
    Receiver->>MQ: Produce MESSAGE_RECEIVED
    Receiver->>VK_IN: OK

    MQ->>Processor: Consume MESSAGE_RECEIVED
    Processor->>MQ: Produce MESSAGE_REQUIRE_ANSWER

    MQ->>Processor: Consume MESSAGE_REQUIRE_ANSWER
    Processor->>AI: Generate response
    AI-->>Processor: AI response
    Processor->>MQ: Produce SEND_MESSAGE
    MQ->>Facade: Consume SEND_MESSAGE

    Facade->>VK_OUT: Send message
    Facade->>MQ: Produce SEND_MESSAGE
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

- **Security Decorator** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ VK
- **Value Objects** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∏–ø–æ–≤
- **Input Validation** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üé® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ì–∏–±–∫–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å VK –Ω–∞ –¥—Ä—É–≥—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
- –ú–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

### –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å  
- –ö–∞–∂–¥—ã–π —Å–ª–æ–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- Fake objects –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–∫–æ–≤
- –ë—ã—Å—Ç—Ä—ã–µ unit-—Ç–µ—Å—Ç—ã –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### Maintainability
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –Ø–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
